<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Col McDermott">
<meta name="dcterms.date" content="2025-03-12">
<meta name="description" content="An introductory examination of racial gender bias in a predictive ML model (predicting employment).">

<title>Post 3 - Auditing Bias in Machine Learning Models – Middlebury College CSCI 0451 Blog - Col McDermott</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6943a74fafdbf25ea2a644024beb669f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background-image: url(../../img/landscape.png);
background-size: cover;
      }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Middlebury College CSCI 0451 Blog - Col McDermott</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Blog Info</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Col-McDermott"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Post 3 - Auditing Bias in Machine Learning Models</h1>
                  <div>
        <div class="description">
          An introductory examination of racial gender bias in a predictive ML model (predicting employment).
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Col McDermott </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 12, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>In this analysis, I explore the construction of a predictive classification model and subsequently examine the model’s properties and behavior to audit for bias. Specifically, the model I constructed aims to predict the employment status of a given individual. Following the refining process, the behavior, accuracy, and error rates of the model are investigated and compared across each racial group outlined in the data. The purpose of this is to uncover any biases on the basis of race the model may be exercising when making predictions for certain individuals. While the model is blind to racial identity during training, this does not eliminate the possibility that systemic racial biases are reflected in the model’s predictive behavior. To audit for potential bias, the model is checked for three primary “fairness” criteria: calibration, error rate balance, and statistical parity. In the search for bias, it is found that the refined model is relatively well-calibrated across each of the racial groups present in the data, but the model generally fails to satisfy the error-balance and statistical parity conditions of accepted “fairness”. Ultimately, the model is shown to exhibit “unfair” (i.e.&nbsp;inconsistent) predictive behavior pertaining to the racial identity of individuals in the data. The results of this introductory study highlight the crucial role of diligently investigating the presence of group-based bias and “unfairness” exercised by classification models even when such models are blind to the group identity. Considering these findings in the context of employment prediction, this study serves as an example of how systemic biases perpetuated through an automated decision classifier can contribute and compound upon past injustices that have discriminantly affected individuals of certain racial identities more than others.</p>
<section id="accessing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="accessing-the-data">Accessing the Data</h2>
<div id="cell-3" class="cell" data-execution_count="164">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Includuing all additional imports</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score, train_test_split</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folktables <span class="im">import</span> ACSDataSource, BasicProblem</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Downloading ACS PUMS data for the state of Massachusetts - Code provided by Prof. Chodrow</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>STATE <span class="op">=</span> <span class="st">"MA"</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> ACSDataSource(survey_year <span class="op">=</span> <span class="st">"2018"</span>, </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                            horizon <span class="op">=</span> <span class="st">"1-Year"</span>, </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                            survey <span class="op">=</span> <span class="st">"person"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>ma <span class="op">=</span> ds.get_data(states <span class="op">=</span> [STATE], download <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Including all additional imports</em></p>
<p>The data for this study comes from an ACS (American Community Survey) data set. Specifically, the data is from a 2018 PUMS (Public Use Microdata Sample) survey for the state of Massachusetts. Each observation from this data set is an individual massachusetts resident who completed the 2018 PUMS survey. The data is downloaded using the <code>ACSDataSource</code> class from the <code>folktables</code> package.</p>
<section id="subsetting-variables---extracting-relevant-features" class="level3">
<h3 class="anchored" data-anchor-id="subsetting-variables---extracting-relevant-features">Subsetting Variables - Extracting Relevant Features</h3>
<div id="cell-6" class="cell" data-execution_count="165">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">vars</span> <span class="op">=</span> [<span class="st">"AGEP"</span>, <span class="st">"SCHL"</span>, <span class="st">"MAR"</span>, <span class="st">"RELP"</span>, <span class="st">"DIS"</span>, <span class="st">"ESP"</span>, <span class="st">"CIT"</span>, <span class="st">"MIG"</span>, <span class="st">"MIL"</span>, <span class="st">"ANC"</span>, <span class="st">"NATIVITY"</span>, <span class="st">"DEAR"</span>, <span class="st">"DEYE"</span>, <span class="st">"DREM"</span>, <span class="st">"SEX"</span>, <span class="st">"RAC1P"</span>, <span class="st">"ESR"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Untouched, the data contains nearly 300 different features. However, for this study, I will only be using a subset of the columns:</p>
<ul>
<li><code>AGEP</code>: Age (Range 0 - 99)</li>
<li><code>SCHL</code>: Educational Attainment (Range 1 - 24)</li>
<li><code>MAR</code>: Marital Status (Range 1 - 5)</li>
<li><code>RELP</code>: Relationship to Householder (Range 1 - 17)</li>
<li><code>DIS</code>: Disability Present (Binary)</li>
<li><code>ESP</code>: Employment Status of Parents (Range 1 - 8)</li>
<li><code>CIT</code>: Citizenship Status (Range 1 - 5)</li>
<li><code>MIG</code>: Mobility Status - Lived in Specified Location 1 Year Ago (Range 1 - 3)</li>
<li><code>MIL</code>: Military Service (Range 1 - 5)</li>
<li><code>ANC</code>: Ancestry (Range 1 - 4, 8)</li>
<li><code>NATIVITY</code>: Nativity (Binary)</li>
<li><code>DEAR</code>: Hearing Difficulty (Binary)</li>
<li><code>DEYE</code>: Vision Difficulty (Binary)</li>
<li><code>DREM</code>: Cognitive Difficulty (Binary)</li>
<li><code>SEX</code>: Sex (Binary)</li>
<li><code>RAC1P</code>: Race (Range 1 - 9)</li>
<li><code>ESR</code>: Employment Status (Range 1 - 6)</li>
<li><code>PINCP</code>: Total Person Income (Integer Range of Income in US Dollars: -19997 - 4209995)</li>
</ul>
</section>
</section>
<section id="model-1---predicting-employment-status" class="level2">
<h2 class="anchored" data-anchor-id="model-1---predicting-employment-status">Model 1 - Predicting Employment Status</h2>
<section id="data-preparation" class="level4">
<h4 class="anchored" data-anchor-id="data-preparation">Data Preparation</h4>
<div id="cell-10" class="cell" data-execution_count="166">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering out employment status (target) and race variables</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>vars1 <span class="op">=</span> [v <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">vars</span> <span class="cf">if</span> v <span class="kw">not</span> <span class="kw">in</span> [<span class="st">"ESR"</span>, <span class="st">"RAC1P"</span>]]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the predictive modeling task - Code provided by Prof. Chodrow</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>EmploymentProblem <span class="op">=</span> BasicProblem(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> vars1,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    target <span class="op">=</span> <span class="st">"ESR"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    target_transform <span class="op">=</span> <span class="kw">lambda</span> x: x <span class="op">==</span> <span class="dv">1</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    group <span class="op">=</span> <span class="st">"RAC1P"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    preprocess <span class="op">=</span> <span class="kw">lambda</span> x: x,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    postprocess <span class="op">=</span> <span class="kw">lambda</span> x: np.nan_to_num(x, <span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>features, label, group <span class="op">=</span> EmploymentProblem.df_to_numpy(ma)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Test, train split procedure</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test, group_train, group_test <span class="op">=</span> train_test_split(features, label, group, test_size <span class="op">=</span> <span class="fl">0.2</span>, random_state <span class="op">=</span> <span class="dv">69</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Code above defines the predictive modeling task and constructs the training data for the employment prediction model.</em></p>
<p>Before constructing the first predictive model, the predictive modeling task is defined. Afterwards, a test-train-split procedure is conducted on the data to prepare it for model fitting.</p>
</section>
<section id="general-descriptives" class="level4">
<h4 class="anchored" data-anchor-id="general-descriptives">General Descriptives</h4>
<div id="cell-13" class="cell" data-execution_count="167">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observing some general descriptives in the training data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> pd.DataFrame(X_train, columns <span class="op">=</span> vars1)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>train[<span class="st">"emp_status"</span>] <span class="op">=</span> y_train.astype(<span class="bu">int</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>train[<span class="st">"race"</span>] <span class="op">=</span> group_train</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>train.dropna(inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of individuals in the training data</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> train.shape[<span class="dv">0</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of employed individuals in the training data</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>emp_prop <span class="op">=</span> train[<span class="st">"emp_status"</span>].mean()</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of employed individuals of each race</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>tot_emp <span class="op">=</span> (train[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">1</span>).<span class="bu">sum</span>()</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>race_prop_emp_tot <span class="op">=</span> (train.groupby(<span class="st">"race"</span>)[<span class="st">"emp_status"</span>].<span class="bu">sum</span>() <span class="op">/</span> tot_emp) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of employed individuals within each race</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>race_prop_emp <span class="op">=</span> train.groupby(<span class="st">"race"</span>).aggregate({<span class="st">"emp_status"</span>: <span class="st">"mean"</span>})</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>race_prop_emp[<span class="st">"u_emp"</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> race_prop_emp[<span class="st">"emp_status"</span>]</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting proportion of employed individuals (total)</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">## Creating dataframe for plotting</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>emp_prop_tot <span class="op">=</span> pd.DataFrame({</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"emp"</span>: [<span class="st">'Unemployed'</span>, <span class="st">'Employed'</span>],</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prop"</span>: [<span class="dv">1</span> <span class="op">-</span> emp_prop, emp_prop]</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="fl">12.5</span>, <span class="fl">7.5</span>))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"seaborn-v0_8-whitegrid"</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>sns.barplot(emp_prop_tot, x <span class="op">=</span> <span class="st">"prop"</span>, y <span class="op">=</span> <span class="st">"emp"</span>, hue <span class="op">=</span> <span class="st">"prop"</span>, palette <span class="op">=</span> [<span class="st">"#D8BFD8"</span>, <span class="st">"#5D3A6D"</span>], legend <span class="op">=</span> <span class="va">False</span>, width <span class="op">=</span> <span class="fl">0.6</span>, ax <span class="op">=</span> ax)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Overall Proportion of Employed Individuals"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>ax.set_yticks([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels([<span class="st">"Unemployed"</span>, <span class="st">"Employed"</span>], fontsize <span class="op">=</span> <span class="dv">12</span>, rotation <span class="op">=</span> <span class="dv">60</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="fl">0.25</span>, <span class="fl">0.55</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>ax.set_xticks([i <span class="op">/</span> <span class="dv">10</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>, <span class="dv">6</span>)])</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels([<span class="ss">f"</span><span class="sc">{</span>i <span class="op">*</span> <span class="dv">10</span><span class="sc">}</span><span class="ss">%"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>, <span class="dv">6</span>)], fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Proportion to all Individuals"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Employment Status"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>ax.text((<span class="dv">1</span> <span class="op">-</span> emp_prop) <span class="op">+</span> <span class="fl">0.01</span>, <span class="dv">0</span>, <span class="ss">f"</span><span class="sc">{</span><span class="bu">round</span>((<span class="dv">1</span> <span class="op">-</span> emp_prop) <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>)<span class="sc">}</span><span class="ss">%"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">12</span>, color <span class="op">=</span> <span class="st">"black"</span>, rotation <span class="op">=</span> <span class="dv">60</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>ax.text(emp_prop <span class="op">+</span> <span class="fl">0.01</span>, <span class="dv">1</span>, <span class="ss">f"</span><span class="sc">{</span><span class="bu">round</span>( emp_prop <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>)<span class="sc">}</span><span class="ss">%"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">12</span>, color <span class="op">=</span> <span class="st">"black"</span>, rotation <span class="op">=</span> <span class="dv">60</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Code above calculates three proportions of employed individuals in the data: 1. General proportion of employment across all individuals 2. Proportion of each race in all employed individuals 3. Proportion of employed individuals within each race.</em></p>
<p><strong>Figure 1</strong></p>
<p>Prior to constructing and fitting the predictive model, it’s useful to explore some general descriptives of the data. In total, there are 56104 individuals in the training data. Approximately <span class="math inline">\(50\%\)</span> of individuals from the data are employed (as of their filling out the survey in 2018).</p>
<div id="cell-15" class="cell" data-execution_count="168">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting proportion of employed individuals across each race</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="fl">12.5</span>, <span class="fl">7.5</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>sns.barplot(race_prop_emp, x <span class="op">=</span> <span class="st">"race"</span>, y <span class="op">=</span> <span class="st">"emp_status"</span>, hue <span class="op">=</span> <span class="st">"race"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">1</span>], width <span class="op">=</span> <span class="fl">0.9</span>, ax <span class="op">=</span> ax, legend <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>sns.barplot(race_prop_emp, x <span class="op">=</span> <span class="st">"race"</span>, y <span class="op">=</span> <span class="st">"u_emp"</span>, hue <span class="op">=</span> <span class="st">"race"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">1</span>], width <span class="op">=</span> <span class="fl">0.9</span>, ax <span class="op">=</span> ax, legend <span class="op">=</span> <span class="va">False</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, edgecolor <span class="op">=</span> <span class="st">"black"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding space between bars</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patch <span class="kw">in</span> ax.patches:</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    patch.set_width(patch.get_width() <span class="op">*</span> <span class="fl">0.8</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Proportion of Employed/Unemployed Individuals Within Each Race Category"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="dv">9</span>))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels([<span class="st">"White"</span>, <span class="st">"Black or African</span><span class="ch">\n</span><span class="st">American"</span>, <span class="st">"American</span><span class="ch">\n</span><span class="st">Indian"</span>, <span class="st">"Alaska</span><span class="ch">\n</span><span class="st">Native"</span>, <span class="st">"A.I./A.N.</span><span class="ch">\n</span><span class="st">Tribe Specified$^1$"</span>, <span class="st">"Asian"</span>, <span class="st">"Native Hawaiian</span><span class="ch">\n</span><span class="st">&amp; Other Pacific</span><span class="ch">\n</span><span class="st">Islander"</span>, <span class="st">"Other</span><span class="ch">\n</span><span class="st">Race"</span>, <span class="st">"Two or more</span><span class="ch">\n</span><span class="st">Races"</span>], fontsize <span class="op">=</span> <span class="dv">12</span>, rotation <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Racial Groups"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Proportion of Employed Individuals"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>ax.set_yticks([(<span class="fl">0.2</span> <span class="op">*</span> i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)])</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels([<span class="ss">f"</span><span class="sc">{</span>(<span class="fl">0.2</span> <span class="op">*</span> i) <span class="op">*</span> <span class="dv">100</span><span class="sc">: .1f}</span><span class="ss">%"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)], fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="dv">1</span>, <span class="fl">0.8</span>, <span class="ss">f"   : Unemployed</span><span class="ch">\n</span><span class="ss">   : Employed"</span>, ha <span class="op">=</span> <span class="st">"left"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, bbox <span class="op">=</span> <span class="bu">dict</span>(facecolor <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, edgecolor <span class="op">=</span> <span class="st">"gray"</span>, boxstyle <span class="op">=</span> <span class="st">"round,pad=0.3"</span>))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">1.075</span>, <span class="fl">0.82</span>, <span class="st">"</span><span class="ch">\u25A0</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">1.075</span>, <span class="fl">0.78</span>, <span class="st">"</span><span class="ch">\u25A0</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>, color <span class="op">=</span> <span class="st">"red"</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Code above plots the proportions calculated above</em></p>
<p><strong>Figure 2</strong></p>
<p>Of the individuals across each racial group:</p>
<ul>
<li>About <span class="math inline">\(51.5\%\)</span> of white individuals are employed</li>
<li>About <span class="math inline">\(46\%\)</span> of black or African American individuals are employed</li>
<li>About <span class="math inline">\(47\%\)</span> of American Indian individuals are employed</li>
<li>Seemingly all (<span class="math inline">\(100\%\)</span>) of Alaska Native individuals are employed</li>
<li><span class="math inline">\(^1\)</span> About <span class="math inline">\(47\%\)</span> of individuals identifying as American Indian and Alaska Native tribes specified, or American Indian or Alaska Native, or not specified and of no other races are employed</li>
<li>About <span class="math inline">\(50\%\)</span> of Asian individuals are employed</li>
<li>About <span class="math inline">\(61\%\)</span> of Native Hawaiian and Other Pacific Islander individuals are employed</li>
<li>About <span class="math inline">\(47.3\%\)</span> of individuals identifying as some other race are employed</li>
<li>About <span class="math inline">\(38\%\)</span> of individuals identifying as two or more races are employed</li>
</ul>
<div id="cell-17" class="cell" data-execution_count="169">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Race and Sex intersection</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sex_recode <span class="op">=</span> {<span class="fl">1.0</span>: <span class="st">"Male"</span>, <span class="fl">2.0</span>: <span class="st">"Female"</span>}</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>train[<span class="st">"SEX_rc"</span>] <span class="op">=</span> train[<span class="st">"SEX"</span>].replace(sex_recode)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ixn_data <span class="op">=</span> train.groupby([<span class="st">"race"</span>, <span class="st">"SEX_rc"</span>]).agg({<span class="st">"emp_status"</span>: <span class="st">"mean"</span>})</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot to display the intersection of race and gender in employment status</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="fl">12.5</span>, <span class="fl">7.5</span>))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"seaborn-v0_8-whitegrid"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>sns.barplot(ixn_data, x <span class="op">=</span> <span class="st">"race"</span>, y <span class="op">=</span> <span class="st">"emp_status"</span>, hue <span class="op">=</span> <span class="st">"SEX_rc"</span>, palette <span class="op">=</span> [<span class="st">"#FFDAB9"</span>, <span class="st">"darkorange"</span>], ax <span class="op">=</span> ax)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Proportion of Employed Individuals for Each Race Category by Sex"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Proportion of Employed Individuals"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Race (Abbreviated Category Names)"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">9</span>))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels([<span class="st">"White"</span>, <span class="st">"Black or African</span><span class="ch">\n</span><span class="st">American"</span>, <span class="st">"American</span><span class="ch">\n</span><span class="st">Indian"</span>, <span class="st">"Alaska</span><span class="ch">\n</span><span class="st">Native"</span>, <span class="st">"A.I./A.N.</span><span class="ch">\n</span><span class="st">Tribe Specified$^1$"</span>, <span class="st">"Asian"</span>, <span class="st">"Native Hawaiian</span><span class="ch">\n</span><span class="st">&amp; Other Pacific</span><span class="ch">\n</span><span class="st">Islander"</span>, <span class="st">"Other</span><span class="ch">\n</span><span class="st">Race"</span>, <span class="st">"Two or more</span><span class="ch">\n</span><span class="st">Races"</span>], </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                   fontsize <span class="op">=</span> <span class="dv">12</span>, rotation <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>ax.set_yticks([(<span class="fl">0.2</span> <span class="op">*</span> i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)])</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels([<span class="ss">f"</span><span class="sc">{</span>(<span class="fl">0.2</span> <span class="op">*</span> i) <span class="op">*</span> <span class="dv">100</span><span class="sc">: .1f}</span><span class="ss">%"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)], fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>ax.legend(frameon <span class="op">=</span> <span class="va">True</span>, fontsize <span class="op">=</span> <span class="dv">12</span>, title <span class="op">=</span> <span class="st">"Sex"</span>, title_fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Code above calculates and plots the proportions of employment within each racial group by sex.</em></p>
<p><em><span class="math inline">\(^1\)</span>“A.I./A.N.Specified”: Individuals who are American Indian and Alaska Native tribes specified, or American Indian or Alaska Native, or not specified and of no other races.</em></p>
<p><strong>Figure 3</strong></p>
<p>The figure above displays the possible intersectionality between race and sex among employed individuals. For five of the nine race categories (all but American Indian, Alaska Native, Asian, and Native Hawaiian &amp; Other Pacific Islander) found in this data set, there does not appear to be a significant difference (<span class="math inline">\(\leq5\%\)</span>) in employment rates between males and females. However, for the remaining racial groups, there does appear to be a noteworthy difference (about <span class="math inline">\(\geq10\%\)</span>) in employment rates between males and females. Therefore, based on this figure, there generally does not appear to be a significant intersectional effect of race and sex on employment rates across all racial groups, but for some groups, an intersectional effect may be present. Please note that this finding does not dismiss the presence of intersectional biases and systemic injustices that may impact certain individuals from this data set. The existence of such intersectionality may very well be present in the data and but just not captured by this figure. Observing the intersectionality of race and gender relating to employment may be more clearly observed through other statistical processes.</p>
</section>
<section id="constructing-and-fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="constructing-and-fitting-the-model">Constructing and Fitting the Model</h3>
<div id="cell-20" class="cell" data-execution_count="170">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constructing and fitting the model</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_pipeline(StandardScaler(), DecisionTreeClassifier())</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="170">
<style>#sk-container-id-10 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-10 {
  color: var(--sklearn-color-text);
}

#sk-container-id-10 pre {
  padding: 0;
}

#sk-container-id-10 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-10 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-10 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-10 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-10 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-10 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-10 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-10 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-10 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-10 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-10 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-10 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-10 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-10 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-10 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-10 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-10 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-10 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-10 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-10 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-10 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-10 div.sk-label label.sk-toggleable__label,
#sk-container-id-10 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-10 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-10 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-10 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-10 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-10 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-10 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-10 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-10 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-10 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-10 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-10" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('standardscaler', StandardScaler()),
                ('decisiontreeclassifier', DecisionTreeClassifier())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox"><label for="sk-estimator-id-28" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('standardscaler', StandardScaler()),
                ('decisiontreeclassifier', DecisionTreeClassifier())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-29" type="checkbox"><label for="sk-estimator-id-29" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>StandardScaler</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></div></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-30" type="checkbox"><label for="sk-estimator-id-30" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>DecisionTreeClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.tree.DecisionTreeClassifier.html">?<span>Documentation for DecisionTreeClassifier</span></a></div></label><div class="sk-toggleable__content fitted"><pre>DecisionTreeClassifier()</pre></div> </div></div></div></div></div></div>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="171">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Refining the model</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Identifying the optimal max_depth value - Model Complexity parameter for DecisionTreeCLassifier model - though iterative process</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># #Updated variables</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>best_max_depth <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>best_avg_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> md <span class="kw">in</span> np.random.randint(<span class="dv">1</span>, <span class="dv">101</span>, size <span class="op">=</span> <span class="dv">10</span>):</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    model.set_params(decisiontreeclassifier__max_depth <span class="op">=</span> md)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    avg_score <span class="op">=</span> cross_val_score(model, X_train, y_train, cv <span class="op">=</span> <span class="dv">5</span>).mean()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> avg_score <span class="op">&gt;</span> best_avg_score:</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        best_avg_score <span class="op">=</span> avg_score</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        best_max_depth <span class="op">=</span> md</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting the model with the optimal max_depth value</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>dtc_refined <span class="op">=</span> model.set_params(decisiontreeclassifier__max_depth <span class="op">=</span> best_max_depth)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>dtc_refined.fit(X_train, y_train)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>gen_score <span class="op">=</span> dtc_refined.score(X_train, y_train)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Refined Model Overall Accuracy: </span><span class="sc">{</span>gen_score <span class="op">*</span> <span class="dv">100</span><span class="sc">: .3f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Refined Model Overall Accuracy:  81.475%</code></pre>
</div>
</div>
<p><em>Code above uses the <code>make_pipeline</code> method from the <code>sklearn</code> package, the training data is first standardized and then used to fit a <code>DecisionTreeClassifier</code> model (also from <code>sklearn</code>). The <code>max_depth</code> parameter for the model is tuned iteratively with corss-validation to set the tree depth that maximizes overall accuracy while mitigating model over-fitting.</em></p>
<p>To refine the model, an iterative process tuning the model complexity (using the <code>max_depth</code> parameter) with cross-validation is conducted. This process aims at model maximizing trining accuracy while reducing the presence of model over-fitting. Following this tuning procedure, the model has an overall accuracy of approximately <span class="math inline">\(83.6\%\)</span> – as an initial metric, this indicates a considerable accurate model.</p>
</section>
<section id="general-accuracy-and-error-rates" class="level3">
<h3 class="anchored" data-anchor-id="general-accuracy-and-error-rates">General Accuracy and Error Rates</h3>
<div id="cell-24" class="cell" data-execution_count="172">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating various accuracy metrics</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Overall Test data accuracy</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>acc_t <span class="op">=</span> dtc_refined.score(X_test, y_test)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>y_preds_t <span class="op">=</span> dtc_refined.predict(X_test).astype(<span class="bu">int</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>acc_t <span class="op">=</span> (y_preds_t <span class="op">==</span> y_test).mean()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix for refined model</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> confusion_matrix(y_test, y_preds_t)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>emp_status <span class="op">=</span> [<span class="st">"Unemployed"</span>, <span class="st">"Employed"</span>]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a heatmap for better confusion matrix visualization</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>sns.heatmap(C, annot <span class="op">=</span> <span class="va">True</span>, annot_kws <span class="op">=</span> {<span class="st">"size"</span>: <span class="dv">12</span>}, fmt <span class="op">=</span> <span class="st">"d"</span>, cmap <span class="op">=</span> <span class="st">"Reds"</span>, cbar <span class="op">=</span> <span class="va">False</span>, ax <span class="op">=</span> ax)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot styling</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Predicted Employment Status"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"True Employment Status"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(emp_status, fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels(emp_status, fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Employment Status Classification Confusion Matrix"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing confusion matrix results</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There were </span><span class="sc">{</span>C[<span class="dv">0</span>, <span class="dv">0</span>]<span class="sc">}</span><span class="ss"> unemployed individuals that were predicted to be unemployed."</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There were </span><span class="sc">{</span>C[<span class="dv">0</span>, <span class="dv">1</span>]<span class="sc">}</span><span class="ss"> unemployed individuals that were predicted to be employed."</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There were </span><span class="sc">{</span>C[<span class="dv">1</span>, <span class="dv">0</span>]<span class="sc">}</span><span class="ss"> employed individuals that were predicted to be unemployed."</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There were </span><span class="sc">{</span>C[<span class="dv">1</span>, <span class="dv">1</span>]<span class="sc">}</span><span class="ss"> unemployed individuals that were predicted to be employed."</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating various accuracies and error rates</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>g_fnr <span class="op">=</span> C[<span class="dv">1</span>, <span class="dv">0</span>] <span class="op">/</span> (C[<span class="dv">1</span>, <span class="dv">0</span>] <span class="op">+</span> C[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>g_tnr <span class="op">=</span> C[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">/</span> (C[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">+</span> C[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>g_fpr <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> g_tnr</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>g_tpr <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> g_fnr</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>g_ppv <span class="op">=</span> C[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">/</span> (C[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">+</span> C[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>g_npv <span class="op">=</span> C[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">/</span> (C[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">+</span> C[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Overall Testing Accuracy: </span><span class="sc">{</span>acc_t <span class="op">*</span> <span class="dv">100</span><span class="sc">: .3f}</span><span class="ss">%"</span>)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"General False Negative Rate: </span><span class="sc">{</span>g_fnr <span class="op">*</span> <span class="dv">100</span><span class="sc">: .3f}</span><span class="ss">%"</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"General True Negative Rate: </span><span class="sc">{</span>g_tnr <span class="op">*</span> <span class="dv">100</span><span class="sc">: .3f}</span><span class="ss">%"</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"General False Positive Rate: </span><span class="sc">{</span>g_fpr <span class="op">*</span> <span class="dv">100</span><span class="sc">: .3f}</span><span class="ss">%"</span>)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"General True Positive Rate: </span><span class="sc">{</span>g_tpr <span class="op">*</span> <span class="dv">100</span><span class="sc">: .3f}</span><span class="ss">%"</span>)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"General Positive Predictive Value: </span><span class="sc">{</span>g_ppv <span class="op">*</span> <span class="dv">100</span><span class="sc">: .3f}</span><span class="ss">%"</span>)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"General Negative Predictive Value: </span><span class="sc">{</span>g_npv <span class="op">*</span> <span class="dv">100</span><span class="sc">: .3f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>There were 5690 unemployed individuals that were predicted to be unemployed.
There were 1284 unemployed individuals that were predicted to be employed.
There were 1271 employed individuals that were predicted to be unemployed.
There were 5782 unemployed individuals that were predicted to be employed.
Overall Testing Accuracy:  81.785%
General False Negative Rate:  18.021%
General True Negative Rate:  81.589%
General False Positive Rate:  18.411%
General True Positive Rate:  81.979%
General Positive Predictive Value:  81.828%
General Negative Predictive Value:  81.741%</code></pre>
</div>
</div>
<p><em>Code above constructs the general confusion matrix for the refined model and calculates the typical accuracy/error rates: FPR, FNR, TPR, TNR, PPV, and NPV</em></p>
<p><strong>Figure 4</strong></p>
<p>Some key overall accuracy and error rates of the refined model are:</p>
<ul>
<li>Overall Test Accuracy: About <span class="math inline">\(83\%\)</span></li>
<li>FNR: About <span class="math inline">\(13\%\)</span> of truly employed individuals were misclassified as unemployed.</li>
<li>TNR: About <span class="math inline">\(79\%\)</span> of truly unemployed individuals were correctly classified as unemployed.</li>
<li>FPR: About <span class="math inline">\(21\%\)</span> of truly unemployed individuals were misclassified as employed.</li>
<li>TPR: About <span class="math inline">\(87\%\)</span> of truly employed individuals were correctly classified as employed</li>
<li>PPV: About <span class="math inline">\(81\%\)</span> of “employed” model predictions are correct while only about <span class="math inline">\(20\%\)</span> are incorrect.</li>
<li>NPV: About <span class="math inline">\(86\%\)</span> of “unemployed” model predictions are correct while only about <span class="math inline">\(14\%\)</span> are incorrect.</li>
</ul>
<p>The general accuracy and error rates outlined above indicate that the refined model is approximately similarly but not equally accurate in predicting that truly unemployed individuals are unemployed versus predicting that truly employed individuals are employed. Additionally, the refined misclassifies truly unemployed individuals and truly employed individuals at similar but notably unequal rates. The refined model yields a PPV and NPV that are close in value (with a difference of <span class="math inline">\(&lt;7\%\)</span>). This suggests that, for any given individual, the refined model is generally similarly good at predicting if this individual is employed as it is at predicting if this individual is unemployed.</p>
<p>While the overall accuracy of the refined model is appears decently high (<span class="math inline">\(83\%\)</span>), it is crucial to investigate the same accuracy rates across different groups of observations found in the data. In this context, the prediction task is to identify if an individual is employed or not. In the data, the race of each individual is provided, and not only is race undoubtedly related to employment in the US but race is also a factor by which systemic biases and systematic discrimination occurs in the American workforce. Although the model was not trained using this variable (race), there is no guarantee that the model does not rely on variables highly related to race or that could stand as proxies for race. Thus, it is critically important to examine if the model perpetuates systemic biases and past injustices effecting certain individuals differently on the bases of racial identity.</p>
</section>
</section>
<section id="auditing-the-model-for-racial-bias" class="level2">
<h2 class="anchored" data-anchor-id="auditing-the-model-for-racial-bias">Auditing the Model for Racial Bias</h2>
<section id="examining-model-accuracy-and-error-rates-across-each-racial-category" class="level3">
<h3 class="anchored" data-anchor-id="examining-model-accuracy-and-error-rates-across-each-racial-category">Examining Model Accuracy and Error Rates Across Each Racial Category</h3>
<div id="cell-27" class="cell" data-execution_count="173">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding a column for indicating correct predictions</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> pd.DataFrame(X_test, columns <span class="op">=</span> vars1)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>test[<span class="st">"emp_status"</span>] <span class="op">=</span> y_test</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>test[<span class="st">"pred"</span>] <span class="op">=</span> y_preds_t</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>test[<span class="st">"correct_pred"</span>] <span class="op">=</span> (y_preds_t <span class="op">==</span> y_test).astype(<span class="bu">int</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Recoding race variable for easier visualization</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>race_recode <span class="op">=</span> {</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.0</span>: <span class="st">"White"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fl">2.0</span>: <span class="st">"Black or African American"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="fl">3.0</span>: <span class="st">"American Indian"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="fl">4.0</span>: <span class="st">"Alaska Native"</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="fl">5.0</span>: <span class="ss">f"A.I./A.N. Tribe Specified</span><span class="ch">\u00B9</span><span class="ss">"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="fl">6.0</span>: <span class="st">"Asian"</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="fl">7.0</span>: <span class="st">" Native Hawaiian and Other Pacific Islander"</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="fl">8.0</span>: <span class="st">"Some Other Race"</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="fl">9.0</span>: <span class="st">" Two or More Races"</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>test[<span class="st">"race"</span>] <span class="op">=</span> group_test</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>test[<span class="st">"Racial Group (Abbreviated Categories)"</span>] <span class="op">=</span> test[<span class="st">"race"</span>].<span class="bu">map</span>(race_recode)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper functions to calculate various accuracy and error rate metrics</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> acc(x):</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x.shape[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"NA"</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">str</span>(<span class="bu">round</span>(x[<span class="st">"correct_pred"</span>].mean() <span class="op">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="op">+</span> <span class="st">" %"</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prop(x):</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">str</span>(<span class="bu">round</span>((x.shape[<span class="dv">0</span>] <span class="op">/</span> train.shape[<span class="dv">0</span>]) <span class="op">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="op">+</span> <span class="st">" %"</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fpr(x):</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">0</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    tn <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">0</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((fp <span class="op">+</span> tn) <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"NA"</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    fpr <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">str</span>(<span class="bu">round</span>(fpr <span class="op">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="op">+</span> <span class="st">" %"</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fnr(x):</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    fn <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">1</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    tp <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">1</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((fn <span class="op">+</span> tp) <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"NA"</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    fnr <span class="op">=</span> fn <span class="op">/</span> (fn <span class="op">+</span> tp)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">str</span>(<span class="bu">round</span>(fnr <span class="op">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="op">+</span> <span class="st">" %"</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tpr(x):</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    fn <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">1</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    tp <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">1</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((fn <span class="op">+</span> tp) <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"NA"</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    tpr <span class="op">=</span> tp <span class="op">/</span> (fn <span class="op">+</span> tp)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">str</span>(<span class="bu">round</span>(tpr <span class="op">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="op">+</span> <span class="st">" %"</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tnr(x):</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">0</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    tn <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">0</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((fp <span class="op">+</span> tn) <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"NA"</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    tnr <span class="op">=</span> tn <span class="op">/</span> (fp <span class="op">+</span> tn)</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">str</span>(<span class="bu">round</span>(tnr <span class="op">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="op">+</span> <span class="st">" %"</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ppv(x):</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    tp <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">1</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">0</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((tp <span class="op">+</span> fp) <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"NA"</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>    ppv <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp)</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">str</span>(<span class="bu">round</span>(ppv <span class="op">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="op">+</span> <span class="st">" %"</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> npv(x):</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>    tn <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">0</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>    fn <span class="op">=</span> ((x[<span class="st">"pred"</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (x[<span class="st">"emp_status"</span>] <span class="op">==</span> <span class="dv">1</span>)).<span class="bu">sum</span>()</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((tn <span class="op">+</span> fn) <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"NA"</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>    npv <span class="op">=</span> tn <span class="op">/</span> (tn <span class="op">+</span> fn)</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">str</span>(<span class="bu">round</span>(npv <span class="op">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="op">+</span> <span class="st">" %"</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Initializing data frame to visualize model accuracy and error rates for each race</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>race_acc <span class="op">=</span> pd.DataFrame(index <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10</span>), columns <span class="op">=</span> [<span class="st">"Racial Group (Abbr. Cats.)"</span>, <span class="st">"Model Accuracy"</span>, <span class="st">"Proportion to Tot. (Aprx.)"</span>, <span class="st">"FPR"</span>, <span class="st">"FNR"</span>, <span class="st">"TPR"</span>, <span class="st">"TNR"</span>, <span class="st">"PPV"</span>, <span class="st">"NPV"</span>])</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Subsetting training data into each race category</span></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> test[test[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">1.0</span>]</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> test[test[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">2.0</span>]</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>r3 <span class="op">=</span> test[test[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">3.0</span>]</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>r4 <span class="op">=</span> test[test[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">4.0</span>]</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>r5 <span class="op">=</span> test[test[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">5.0</span>]</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>r6 <span class="op">=</span> test[test[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">6.0</span>]</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>r7 <span class="op">=</span> test[test[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">7.0</span>]</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>r8 <span class="op">=</span> test[test[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">8.0</span>]</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>r9 <span class="op">=</span> test[test[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">9.0</span>]</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Populating the accuracy/error rates table</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>race_acc.loc[<span class="dv">1</span>] <span class="op">=</span> [race_recode.get(<span class="fl">1.0</span>), acc(r1), prop(r1), fpr(r1), fnr(r1), tpr(r1), tnr(r1), ppv(r1), npv(r1)]</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>race_acc.loc[<span class="dv">3</span>] <span class="op">=</span> [race_recode.get(<span class="fl">2.0</span>), acc(r2), prop(r2), fpr(r2), fnr(r2), tpr(r2), tnr(r2), ppv(r2), npv(r2)]</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>race_acc.loc[<span class="dv">2</span>] <span class="op">=</span> [race_recode.get(<span class="fl">3.0</span>), acc(r3), prop(r3), fpr(r3), fnr(r3), tpr(r3), tnr(r3), ppv(r3), npv(r3)]</span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>race_acc.loc[<span class="dv">4</span>] <span class="op">=</span> [race_recode.get(<span class="fl">4.0</span>), acc(r4), prop(r4), fpr(r4), fnr(r4), tpr(r4), tnr(r4), ppv(r4), npv(r4)]</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>race_acc.loc[<span class="dv">5</span>] <span class="op">=</span> [race_recode.get(<span class="fl">5.0</span>), acc(r5), prop(r5), fpr(r5), fnr(r5), tpr(r5), tnr(r5), ppv(r5), npv(r5)]</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>race_acc.loc[<span class="dv">6</span>] <span class="op">=</span> [race_recode.get(<span class="fl">6.0</span>), acc(r6), prop(r6), fpr(r6), fnr(r6), tpr(r6), tnr(r6), ppv(r6), npv(r6)]</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>race_acc.loc[<span class="dv">7</span>] <span class="op">=</span> [race_recode.get(<span class="fl">7.0</span>), acc(r7), prop(r7), fpr(r7), fnr(r7), tpr(r7), tnr(r7), ppv(r7), npv(r7)]</span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>race_acc.loc[<span class="dv">8</span>] <span class="op">=</span> [race_recode.get(<span class="fl">8.0</span>), acc(r8), prop(r8), fpr(r8), fnr(r8), tpr(r8), tnr(r8), ppv(r8), npv(r8)]</span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>race_acc.loc[<span class="dv">9</span>] <span class="op">=</span> [race_recode.get(<span class="fl">9.0</span>), acc(r9), prop(r9), fpr(r9), fnr(r9), tpr(r9), tnr(r9), ppv(r9), npv(r9)]</span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>race_acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="173">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Racial Group (Abbr. Cats.)</th>
<th data-quarto-table-cell-role="th">Model Accuracy</th>
<th data-quarto-table-cell-role="th">Proportion to Tot. (Aprx.)</th>
<th data-quarto-table-cell-role="th">FPR</th>
<th data-quarto-table-cell-role="th">FNR</th>
<th data-quarto-table-cell-role="th">TPR</th>
<th data-quarto-table-cell-role="th">TNR</th>
<th data-quarto-table-cell-role="th">PPV</th>
<th data-quarto-table-cell-role="th">NPV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>White</td>
<td>81.9 %</td>
<td>20.2 %</td>
<td>18.2 %</td>
<td>17.9 %</td>
<td>82.1 %</td>
<td>81.8 %</td>
<td>82.4 %</td>
<td>81.5 %</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>American Indian</td>
<td>88.2 %</td>
<td>0.0 %</td>
<td>11.1 %</td>
<td>12.5 %</td>
<td>87.5 %</td>
<td>88.9 %</td>
<td>87.5 %</td>
<td>88.9 %</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Black or African American</td>
<td>84.4 %</td>
<td>1.5 %</td>
<td>13.8 %</td>
<td>17.7 %</td>
<td>82.3 %</td>
<td>86.2 %</td>
<td>84.0 %</td>
<td>84.6 %</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Alaska Native</td>
<td>NA</td>
<td>0.0 %</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>A.I./A.N. Tribe Specified¹</td>
<td>80.0 %</td>
<td>0.0 %</td>
<td>0.0 %</td>
<td>33.3 %</td>
<td>66.7 %</td>
<td>100.0 %</td>
<td>100.0 %</td>
<td>66.7 %</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>Asian</td>
<td>79.0 %</td>
<td>1.7 %</td>
<td>28.2 %</td>
<td>14.2 %</td>
<td>85.8 %</td>
<td>71.8 %</td>
<td>76.4 %</td>
<td>82.7 %</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>Native Hawaiian and Other Pacific Islander</td>
<td>77.8 %</td>
<td>0.0 %</td>
<td>33.3 %</td>
<td>16.7 %</td>
<td>83.3 %</td>
<td>66.7 %</td>
<td>83.3 %</td>
<td>66.7 %</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>Some Other Race</td>
<td>79.8 %</td>
<td>0.8 %</td>
<td>16.8 %</td>
<td>24.1 %</td>
<td>75.9 %</td>
<td>83.2 %</td>
<td>79.8 %</td>
<td>79.8 %</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Two or More Races</td>
<td>80.7 %</td>
<td>0.7 %</td>
<td>14.0 %</td>
<td>26.8 %</td>
<td>73.2 %</td>
<td>86.0 %</td>
<td>78.3 %</td>
<td>82.2 %</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><em>Code above subsets the training data into each race category and creates a table displaying the model’s accuracy and error rates in employment/unemployment predictions for each racial group.</em></p>
<p><em><span class="math inline">\(^1\)</span>“A.I./A.N.Specified”: Individuals who are American Indian and Alaska Native tribes specified, or American Indian or Alaska Native, or not specified and of no other races.</em></p>
<p><strong>Table 1</strong></p>
<p>The table above depicts the refined model’s accuracy and error rates for employment prediction of individuals across each racial group in the training data. The general accuracies for each racial group are all largely similar – with values ranging from around <span class="math inline">\(80\%\)</span> to <span class="math inline">\(89\%\)</span> accuracy.</p>
<p><span class="math display">\[FPR = \frac{FP}{FP + TN}\]</span> <span class="math display">\[FNR = \frac{FN}{FN + TP}\]</span></p>
<p>The FPR and FNR for each race are slightly less equal across all racial groups (FPR range from roughly <span class="math inline">\(0\%\)</span> to <span class="math inline">\(33\%\)</span> and FNR range also from <span class="math inline">\(0\%\)</span> to <span class="math inline">\(33\%\)</span>), but these error rates do not differ dramatically.</p>
<p><span class="math display">\[TPR = \frac{TP}{TP + FN}\]</span> <span class="math display">\[TNR = \frac{TN}{TN + FP}\]</span></p>
<p>A similar trend is generally observable for TPR across each racial group (majority TPR range from about <span class="math inline">\(83\%\)</span> to <span class="math inline">\(100\%\)</span>) - with the exception of the “American Indian and Alaska Native tribes specified” group with a notably lower TPR: <span class="math inline">\(67\%\)</span>). As for TNR, there is a larger spread in values across all racial groups with a general TNR range of <span class="math inline">\(67\%\)</span> to <span class="math inline">\(100\%\)</span>.</p>
<p><span class="math display">\[PPV = \frac{TP}{TP + FP}\]</span> <span class="math display">\[NPV = \frac{TN}{TN + FN}\]</span></p>
<p>Further, the PPV and NPV for each racial group are primarily similar and display a smaller spread of values – with PPV metrics ranging from approximately <span class="math inline">\(77\%\)</span> to <span class="math inline">\(100\%\)</span> and NPV values ranging from approximately <span class="math inline">\(67\%\)</span> to <span class="math inline">\(100\%\)</span>.</p>
<div id="cell-29" class="cell" data-execution_count="174">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing column types for easier visualization</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Saving a data frame for late use</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>erb <span class="op">=</span> race_acc.copy()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> race_acc.columns[<span class="dv">1</span>:]:</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (race_acc[col].dtype <span class="op">==</span> <span class="st">"object"</span>):</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        race_acc[col] <span class="op">=</span> pd.to_numeric(race_acc[col].<span class="bu">str</span>.replace(<span class="st">"%"</span>, <span class="st">""</span>).replace(<span class="st">"NA"</span>, np.nan))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the information described in the table above for easier visualization</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"seaborn-v0_8-whitegrid"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy by Race</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>sns.barplot(race_acc, x <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, y <span class="op">=</span> <span class="st">"Model Accuracy"</span>, hue <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">1</span>], ax <span class="op">=</span> ax[<span class="dv">0</span>])</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].axhline(gen_score <span class="op">*</span> <span class="dv">100</span>, color <span class="op">=</span> <span class="st">"black"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylim(<span class="dv">40</span>, <span class="dv">95</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">"Model Accuracy"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">""</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Model Accuracy"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xticks(<span class="bu">range</span>(<span class="dv">9</span>))</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xticklabels([<span class="st">"White"</span>, <span class="st">"Black or African</span><span class="ch">\n</span><span class="st">American"</span>, <span class="st">"American</span><span class="ch">\n</span><span class="st">Indian"</span>, <span class="st">"Alaska</span><span class="ch">\n</span><span class="st">Native"</span>, <span class="st">"A.I./A.N.</span><span class="ch">\n</span><span class="st">Tribe Specified$^1$"</span>, <span class="st">"Asian"</span>, <span class="st">"Native Hawaiian</span><span class="ch">\n</span><span class="st">&amp; Other Pacific</span><span class="ch">\n</span><span class="st">Islander"</span>, <span class="st">"Other</span><span class="ch">\n</span><span class="st">Race"</span>, <span class="st">"Two or more</span><span class="ch">\n</span><span class="st">Races"</span>], fontsize <span class="op">=</span> <span class="dv">12</span>, rotation <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_yticks([(<span class="dv">10</span> <span class="op">*</span> i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>, <span class="dv">10</span>)])</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_yticklabels([<span class="ss">f"</span><span class="sc">{</span><span class="dv">10</span> <span class="op">*</span> i<span class="sc">}</span><span class="ss">%"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>, <span class="dv">10</span>)], fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].text(<span class="fl">6.15</span>, <span class="dv">92</span>, <span class="ss">f"</span><span class="ch">\u2013</span><span class="ss"> Overall Model Accuracy: </span><span class="sc">{</span>gen_score <span class="op">*</span> <span class="dv">100</span><span class="sc">: .2f}</span><span class="ss">%"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, bbox <span class="op">=</span> <span class="bu">dict</span>(facecolor <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, edgecolor <span class="op">=</span> <span class="st">"gray"</span>, boxstyle <span class="op">=</span> <span class="st">"round,pad=0.3"</span>))</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># FPR &amp; FNR by Race</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>sns.barplot(race_acc, x <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, y <span class="op">=</span> <span class="st">"FPR"</span>, hue <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">1</span>], ax <span class="op">=</span> ax[<span class="dv">1</span>])</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>sns.barplot(race_acc, x <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, y <span class="op">=</span> <span class="st">"FNR"</span>, hue <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">1</span>], alpha <span class="op">=</span> <span class="fl">0.5</span>, ax <span class="op">=</span> ax[<span class="dv">1</span>], edgecolor <span class="op">=</span> <span class="st">"black"</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].axhline(g_fpr <span class="op">*</span> <span class="dv">100</span>, color <span class="op">=</span> <span class="st">"purple"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].axhline(g_fnr <span class="op">*</span> <span class="dv">100</span>, color <span class="op">=</span> <span class="st">"black"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">"FPR &amp; FNR"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">""</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">"FPR &amp; FNR"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xticks(<span class="bu">range</span>(<span class="dv">9</span>))</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xticklabels([<span class="st">"White"</span>, <span class="st">"Black or African</span><span class="ch">\n</span><span class="st">American"</span>, <span class="st">"American</span><span class="ch">\n</span><span class="st">Indian"</span>, <span class="st">"Alaska</span><span class="ch">\n</span><span class="st">Native"</span>, <span class="st">"A.I./A.N.</span><span class="ch">\n</span><span class="st">Tribe Specified$^1$"</span>, <span class="st">"Asian"</span>, <span class="st">"Native Hawaiian</span><span class="ch">\n</span><span class="st">&amp; Other Pacific</span><span class="ch">\n</span><span class="st">Islander"</span>, <span class="st">"Other</span><span class="ch">\n</span><span class="st">Race"</span>, <span class="st">"Two or more</span><span class="ch">\n</span><span class="st">Races"</span>], fontsize <span class="op">=</span> <span class="dv">12</span>, rotation <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_yticks([i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">35</span>, <span class="dv">5</span>)])</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_yticklabels([<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">%"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">35</span>, <span class="dv">5</span>)], fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">6.5</span>, <span class="fl">29.5</span>, <span class="ss">f"</span><span class="ch">\u2013</span><span class="ss"> Overall Model FNR: </span><span class="sc">{</span>g_fnr <span class="op">*</span> <span class="dv">100</span><span class="sc">: .2f}</span><span class="ss">%</span><span class="ch">\n</span><span class="ss">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, bbox <span class="op">=</span> <span class="bu">dict</span>(facecolor <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, edgecolor <span class="op">=</span> <span class="st">"gray"</span>, boxstyle <span class="op">=</span> <span class="st">"round,pad=0.3"</span>))</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">6.5</span>, <span class="dv">29</span>, <span class="ss">f"   Overall Model FPR: </span><span class="sc">{</span>g_fpr <span class="op">*</span> <span class="dv">100</span><span class="sc">: .2f}</span><span class="ss">%"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">5.25</span>, <span class="dv">29</span>, <span class="st">"</span><span class="ch">\u2013</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"purple"</span>)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">1.5</span>, <span class="fl">29.5</span>, <span class="ss">f"   : FNR</span><span class="ch">\n</span><span class="ss">   : FPR"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, bbox <span class="op">=</span> <span class="bu">dict</span>(facecolor <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, edgecolor <span class="op">=</span> <span class="st">"gray"</span>, boxstyle <span class="op">=</span> <span class="st">"round,pad=0.3"</span>))</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">1.25</span>, <span class="fl">29.9</span>, <span class="st">"</span><span class="ch">\u25A0</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">1.25</span>, <span class="fl">29.2</span>, <span class="st">"</span><span class="ch">\u25A0</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>, color <span class="op">=</span> <span class="st">"red"</span>)</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Model Accuracy and FPR/FNR by Racial Group"</span>, fontsize <span class="op">=</span> <span class="dv">20</span>)</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.5</span>, <span class="fl">0.005</span>, <span class="st">"Racial Group (Abbreviated Category Names)"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Code above uses the data frame constructed in the previous chunk to plot the overall model accuracy and FPR/FNR by racial group</em></p>
<p><strong>Figure 5</strong></p>
<p>The plots above provide a visual accompaniment to the information displayed in <strong>Table 1</strong>. As shown in overall accuracy plot (left), the model’s accuracy for the majority of racial groups is lower than the general accuracy. The largest disparity in general accuracy to the accuracy for a specific racial group is found for individuals identifying as Native Hawaiian &amp; Other Pacific Islander. Regarding FPR anf FNR, the model’s error rates across the racial groups appear to differ considerably both from one another and also from the general FPR and FNR.</p>
<div id="cell-31" class="cell" data-execution_count="175">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"seaborn-v0_8-whitegrid"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># TPR &amp; TNR by Race</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(race_acc, x <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, y <span class="op">=</span> <span class="st">"TPR"</span>, hue <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">1</span>], ax <span class="op">=</span> ax[<span class="dv">0</span>])</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>sns.barplot(race_acc, x <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, y <span class="op">=</span> <span class="st">"TNR"</span>, hue <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">1</span>], alpha <span class="op">=</span> <span class="fl">0.5</span>, ax <span class="op">=</span> ax[<span class="dv">0</span>], edgecolor <span class="op">=</span> <span class="st">"black"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].axhline(g_tpr <span class="op">*</span> <span class="dv">100</span>, color <span class="op">=</span> <span class="st">"purple"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].axhline(g_tnr <span class="op">*</span> <span class="dv">100</span>, color <span class="op">=</span> <span class="st">"black"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylim(<span class="dv">60</span>, <span class="dv">105</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">"TPR &amp; TNR"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">""</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">"TPR &amp; TNR"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xticks(<span class="bu">range</span>(<span class="dv">9</span>))</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xticklabels([<span class="st">"White"</span>, <span class="st">"Black or African</span><span class="ch">\n</span><span class="st">American"</span>, <span class="st">"American</span><span class="ch">\n</span><span class="st">Indian"</span>, <span class="st">"Alaska</span><span class="ch">\n</span><span class="st">Native"</span>, <span class="st">"A.I./A.N.</span><span class="ch">\n</span><span class="st">Tribe Specified$^1$"</span>, <span class="st">"Asian"</span>, <span class="st">"Native Hawaiian</span><span class="ch">\n</span><span class="st">&amp; Other Pacific</span><span class="ch">\n</span><span class="st">Islander"</span>, <span class="st">"Other</span><span class="ch">\n</span><span class="st">Race"</span>, <span class="st">"Two or more</span><span class="ch">\n</span><span class="st">Races"</span>], fontsize <span class="op">=</span> <span class="dv">12</span>, rotation <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_yticks(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">110</span>, <span class="dv">10</span>)[<span class="dv">6</span>:])</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_yticklabels([<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">%"</span> <span class="cf">for</span> i <span class="kw">in</span> (<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">110</span>, <span class="dv">10</span>)[<span class="dv">6</span>:])], fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].text(<span class="fl">6.427</span>, <span class="fl">102.5</span>, <span class="ss">f"</span><span class="ch">\u2013</span><span class="ss"> Overall Model TNR: </span><span class="sc">{</span>g_tnr <span class="op">*</span> <span class="dv">100</span><span class="sc">: .2f}</span><span class="ss">%</span><span class="ch">\n</span><span class="ss">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, bbox <span class="op">=</span> <span class="bu">dict</span>(facecolor <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, edgecolor <span class="op">=</span> <span class="st">"gray"</span>, boxstyle <span class="op">=</span> <span class="st">"round,pad=0.3"</span>))</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].text(<span class="fl">6.427</span>, <span class="dv">102</span>, <span class="ss">f"   Overall Model TPR: </span><span class="sc">{</span>g_tpr <span class="op">*</span> <span class="dv">100</span><span class="sc">: .2f}</span><span class="ss">%"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].text(<span class="fl">5.17</span>, <span class="dv">102</span>, <span class="st">"</span><span class="ch">\u2013</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"purple"</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].text(<span class="fl">1.5</span>, <span class="fl">102.5</span>, <span class="ss">f"   : TNR</span><span class="ch">\n</span><span class="ss">   : TPR"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, bbox <span class="op">=</span> <span class="bu">dict</span>(facecolor <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, edgecolor <span class="op">=</span> <span class="st">"gray"</span>, boxstyle <span class="op">=</span> <span class="st">"round,pad=0.3"</span>))</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].text(<span class="fl">1.25</span>, <span class="fl">103.1</span>, <span class="st">"</span><span class="ch">\u25A0</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].text(<span class="fl">1.25</span>, <span class="fl">102.1</span>, <span class="st">"</span><span class="ch">\u25A0</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>, color <span class="op">=</span> <span class="st">"red"</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># PPV &amp; NPV by Race</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>sns.barplot(race_acc, x <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, y <span class="op">=</span> <span class="st">"PPV"</span>, hue <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">1</span>], ax <span class="op">=</span> ax[<span class="dv">1</span>])</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>sns.barplot(race_acc, x <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, y <span class="op">=</span> <span class="st">"NPV"</span>, hue <span class="op">=</span> <span class="st">"Racial Group (Abbr. Cats.)"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">1</span>], alpha <span class="op">=</span> <span class="fl">0.5</span>, ax <span class="op">=</span> ax[<span class="dv">1</span>], edgecolor <span class="op">=</span> <span class="st">"black"</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].axhline(g_npv <span class="op">*</span> <span class="dv">100</span>, color <span class="op">=</span> <span class="st">"purple"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].axhline(g_ppv <span class="op">*</span> <span class="dv">100</span>, color <span class="op">=</span> <span class="st">"black"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylim(<span class="dv">60</span>, <span class="dv">105</span>)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">"PPV &amp; NPV"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">""</span>)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">"PPV &amp; NPV"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xticks(<span class="bu">range</span>(<span class="dv">9</span>))</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xticklabels([<span class="st">"White"</span>, <span class="st">"Black or African</span><span class="ch">\n</span><span class="st">American"</span>, <span class="st">"American</span><span class="ch">\n</span><span class="st">Indian"</span>, <span class="st">"Alaska</span><span class="ch">\n</span><span class="st">Native"</span>, <span class="st">"A.I./A.N.</span><span class="ch">\n</span><span class="st">Tribe Specified$^1$"</span>, <span class="st">"Asian"</span>, <span class="st">"Native Hawaiian</span><span class="ch">\n</span><span class="st">&amp; Other Pacific</span><span class="ch">\n</span><span class="st">Islander"</span>, <span class="st">"Other</span><span class="ch">\n</span><span class="st">Race"</span>, <span class="st">"Two or more</span><span class="ch">\n</span><span class="st">Races"</span>], fontsize <span class="op">=</span> <span class="dv">12</span>, rotation <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_yticks(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">110</span>, <span class="dv">10</span>)[<span class="dv">6</span>:])</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_yticklabels([<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">%"</span> <span class="cf">for</span> i <span class="kw">in</span> (<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">110</span>, <span class="dv">10</span>)[<span class="dv">6</span>:])], fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">6.427</span>, <span class="fl">102.5</span>, <span class="ss">f"</span><span class="ch">\u2013</span><span class="ss"> Overall Model PPV: </span><span class="sc">{</span>g_ppv <span class="op">*</span> <span class="dv">100</span><span class="sc">: .2f}</span><span class="ss">%</span><span class="ch">\n</span><span class="ss">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, bbox <span class="op">=</span> <span class="bu">dict</span>(facecolor <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, edgecolor <span class="op">=</span> <span class="st">"gray"</span>, boxstyle <span class="op">=</span> <span class="st">"round,pad=0.3"</span>))</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">6.427</span>, <span class="dv">102</span>, <span class="ss">f"   Overall Model NPV: </span><span class="sc">{</span>g_npv <span class="op">*</span> <span class="dv">100</span><span class="sc">: .2f}</span><span class="ss">%"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>)</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">5.17</span>, <span class="dv">102</span>, <span class="st">"</span><span class="ch">\u2013</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"purple"</span>)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">1.5</span>, <span class="fl">102.5</span>, <span class="ss">f"   : NPV</span><span class="ch">\n</span><span class="ss">   : PPV"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, bbox <span class="op">=</span> <span class="bu">dict</span>(facecolor <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, edgecolor <span class="op">=</span> <span class="st">"gray"</span>, boxstyle <span class="op">=</span> <span class="st">"round,pad=0.3"</span>))</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">1.25</span>, <span class="fl">103.1</span>, <span class="st">"</span><span class="ch">\u25A0</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].text(<span class="fl">1.25</span>, <span class="fl">102.1</span>, <span class="st">"</span><span class="ch">\u25A0</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>, color <span class="op">=</span> <span class="st">"red"</span>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Model Accuracy and Error Rates by Racial Group"</span>, fontsize <span class="op">=</span> <span class="dv">20</span>)</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.5</span>, <span class="fl">0.005</span>, <span class="st">"Racial Group (Abbreviated Category Names)"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Code above uses the data frame constructed in the previous chunk to plot the and TPR/TNR and PPV/NPV by racial group</em></p>
<p><strong>Figure 6</strong></p>
<p>The plots above provide additional visual accompaniment for the accuracy rates and predictive values displayed in <strong>Table 1</strong>. As shown in the plot of TPR/TNR for each racial group, the TPR and TNR tend to deviate notably both from one another and from the model’s general TPR/TNR. For some racial groups though, such as white individuals in the data, the TPR and TNR are very close to the general TPR/TNR. As shown on the right, the the PPV and NPV metrics for each racial group are generally not majorly far from the overall PPV and NPV. However, note that this trend does not extend to all racial groups, such as individuals in the “A.I./A.N. Tribe Specified” or Native Hawaiian &amp; Other Pacific Islander groups, who have a notably lower NPV values than the general NPV.</p>
<p>Based on the information depicted in the <strong>Table 1</strong> and the plots from <strong>Figure 7</strong> and <strong>Figure 8</strong>, it is clear that the model’s accuracy and error rates are not entirely consistent across all racial groups. This inconsistency is particularly concerning for individuals identifying as A.I./A.N. Tribe Specified <span class="math inline">\(^1\)</span>, Asian, or Native Hawaiian &amp; Other Pacific Islander. That is, for individuals associating with these racial groups, it appears that the model is not as good at making accurate predictions of employment status as it is for predicting the employment status of other racial groups. This analysis suggests that the model may be perpetuating (through the cost of its misclassifications) systemic biases and past injustices that effect certain individuals differently on the bases of racial identity.</p>
</section>
<section id="bias-measures" class="level3">
<h3 class="anchored" data-anchor-id="bias-measures">Bias Measures</h3>
<section id="calibration" class="level4">
<h4 class="anchored" data-anchor-id="calibration">Calibration:</h4>
<div id="cell-35" class="cell" data-execution_count="176">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examining the calibration of the model</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Calculating the probability that a prediction is positive for each racial group</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>calibration <span class="op">=</span> test.groupby(<span class="st">"race"</span>).aggregate({<span class="st">"pred"</span>: <span class="st">"mean"</span>})</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>calibration[<span class="st">"pred"</span>] <span class="op">=</span> calibration[<span class="st">"pred"</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>calibration[<span class="st">"pred_prob_diff"</span>] <span class="op">=</span> np.<span class="bu">abs</span>(calibration[<span class="st">"pred"</span>] <span class="op">-</span> ((test[<span class="st">"pred"</span>]).mean() <span class="op">*</span> <span class="dv">100</span>))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>calibration[<span class="st">"emp_status_rate"</span>] <span class="op">=</span> train.groupby(<span class="st">"race"</span>).aggregate({<span class="st">"emp_status"</span>: <span class="st">"mean"</span>}) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>calibration</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plotting these probabilities for each racial group</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="fl">12.5</span>, <span class="fl">7.5</span>))</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"seaborn-v0_8-whitegrid"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>sns.barplot(calibration, x <span class="op">=</span> <span class="st">"race"</span>, y <span class="op">=</span> <span class="st">"pred"</span>, hue <span class="op">=</span> <span class="st">"race"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">2</span>], ax <span class="op">=</span> ax, legend <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>sns.barplot(calibration, x <span class="op">=</span> <span class="st">"race"</span>, y <span class="op">=</span> <span class="st">"emp_status_rate"</span>, hue <span class="op">=</span> <span class="st">"race"</span>, palette <span class="op">=</span> sns.color_palette()[:<span class="op">-</span><span class="dv">2</span>], ax <span class="op">=</span> ax, legend <span class="op">=</span> <span class="va">False</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, edgecolor <span class="op">=</span> <span class="st">"black"</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Model Calibration by Racial Group"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Racial Group (Abbreviated Category Names)"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="dv">8</span>))</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels([<span class="st">"White"</span>, <span class="st">"Black or African</span><span class="ch">\n</span><span class="st">American"</span>, <span class="st">"American</span><span class="ch">\n</span><span class="st">Indian"</span>, <span class="st">"A.I./A.N.</span><span class="ch">\n</span><span class="st">Tribe Specified$^1$"</span>, <span class="st">"Asian"</span>, <span class="st">"Native Hawaiian</span><span class="ch">\n</span><span class="st">&amp; Other Pacific</span><span class="ch">\n</span><span class="st">Islander"</span>, <span class="st">"Other</span><span class="ch">\n</span><span class="st">Race"</span>, <span class="st">"Two or more</span><span class="ch">\n</span><span class="st">Races"</span>], fontsize <span class="op">=</span> <span class="dv">12</span>, rotation <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Probability of Positive Prediction"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>ax.set_yticks([<span class="dv">20</span> <span class="op">*</span> i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)])</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels([<span class="ss">f"</span><span class="sc">{</span><span class="dv">20</span> <span class="op">*</span> i<span class="sc">}</span><span class="ss">%"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)], fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="dv">0</span>, <span class="dv">95</span>, <span class="ss">f"   : Prob. Pos. Outcome</span><span class="ch">\n</span><span class="ss">   : Prob. Pos. Pred."</span>, ha <span class="op">=</span> <span class="st">"left"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, bbox <span class="op">=</span> <span class="bu">dict</span>(facecolor <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span>, edgecolor <span class="op">=</span> <span class="st">"gray"</span>, boxstyle <span class="op">=</span> <span class="st">"round,pad=0.3"</span>))</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">0.075</span>, <span class="dv">97</span>, <span class="st">"</span><span class="ch">\u25A0</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">0.075</span>, <span class="fl">93.5</span>, <span class="st">"</span><span class="ch">\u25A0</span><span class="st">"</span>, ha <span class="op">=</span> <span class="st">"center"</span>, va <span class="op">=</span> <span class="st">"center"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>, color <span class="op">=</span> <span class="st">"red"</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Code above calculates the probability of the model predicting an individual to be employed for each racial group and plots these probabilities together.</em></p>
<p><strong>Figure 7</strong></p>
<p>As shown in the calibration plot above, the model is generally well-calibrated for the majority of racial groups. The model’s predicted probabilities of employment are generally equal to the actual probability of employment irrespective of racial group in that for most groups. However, for some racial groups, such as A.I./A.N.Specified <span class="math inline">\(^1\)</span> and Asian individuals, the probability of a positive prediction is notably different from the probability of employment for these groups respectively. This suggests that the model is well calibrated for most racial groups (for individuals identifying as white, black or African American, American Indian, Alaska Native, Asian, some other race, or two or more races), but not necessarily well-calibrated across <strong>all</strong> racial groups.</p>
</section>
<section id="error-rate-balance" class="level4">
<h4 class="anchored" data-anchor-id="error-rate-balance">Error Rate Balance:</h4>
<div id="cell-38" class="cell" data-execution_count="177">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparing FPR and TPR across each racial group</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>erb[[<span class="st">"Racial Group (Abbr. Cats.)"</span>, <span class="st">"FPR"</span>, <span class="st">"TPR"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="177">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Racial Group (Abbr. Cats.)</th>
<th data-quarto-table-cell-role="th">FPR</th>
<th data-quarto-table-cell-role="th">TPR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>White</td>
<td>18.2 %</td>
<td>82.1 %</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>American Indian</td>
<td>11.1 %</td>
<td>87.5 %</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Black or African American</td>
<td>13.8 %</td>
<td>82.3 %</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Alaska Native</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>A.I./A.N. Tribe Specified¹</td>
<td>0.0 %</td>
<td>66.7 %</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>Asian</td>
<td>28.2 %</td>
<td>85.8 %</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>Native Hawaiian and Other Pacific Islander</td>
<td>33.3 %</td>
<td>83.3 %</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>Some Other Race</td>
<td>16.8 %</td>
<td>75.9 %</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Two or More Races</td>
<td>14.0 %</td>
<td>73.2 %</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Table 2</strong></p>
<p>The table above revisits a subset of information presented in <strong>Table 1</strong>. As depicted in this table, the FPR for the majority of racial groups (white, black or African American, American Indian, Asian, some other race, two or more races) are generally similar values with the largest disparity being <span class="math inline">\(&lt; 10\%\)</span>. The same general property can be observed in TPR across racial groups. However, while for a majority of racial groups, the FPR and TPR appear to be mostly balanced, this is certainly not the case for FPR anf TPR across <strong>all</strong> racial groups. E.G, the FPR and TPR for for individuals of the A.I./A.N. Tribe Specified <span class="math inline">\(^1\)</span> group is significantly lower than for all other groups, suggesting that the model correctly predicts A.I./A.N. Tribe Specified <span class="math inline">\(^1\)</span> as employed with less accuracy than for other groups (the opposite observation can be made for Native Hawaiian &amp; Other Pacific Islander individuals as well). That is, this model does not strictly satisfy true <em>error-rate balance</em>.</p>
</section>
<section id="statistical-parity" class="level4">
<h4 class="anchored" data-anchor-id="statistical-parity">Statistical Parity:</h4>
<div id="cell-41" class="cell" data-execution_count="178">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the absolute difference of the probabilities of a positive prediction for each racial group to assess statistical parity</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>spd <span class="op">=</span> calibration[<span class="st">"pred"</span>].<span class="bu">max</span>() <span class="op">-</span> calibration[<span class="st">"pred"</span>].<span class="bu">min</span>()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Statistical Parity (ABS.) Difference: </span><span class="sc">{</span>spd<span class="sc">: .2f}</span><span class="ss">%"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating an adjusted SPD (excluding the group with a 100% positive prediction probability)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>spd_adj <span class="op">=</span> calibration[calibration[<span class="st">"pred"</span>] <span class="op">&lt;</span> <span class="dv">100</span>][<span class="st">"pred"</span>].<span class="bu">max</span>() <span class="op">-</span> calibration[calibration[<span class="st">"pred"</span>] <span class="op">&lt;</span> <span class="dv">100</span>][<span class="st">"pred"</span>].<span class="bu">min</span>()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Adjusted Statistical Parity (ABS.) Difference: </span><span class="sc">{</span>spd_adj<span class="sc">: .2f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Statistical Parity (ABS.) Difference:  28.37%
Adjusted Statistical Parity (ABS.) Difference:  28.37%</code></pre>
</div>
</div>
<p>To assess statistical parity, the absolute difference between the maximum probability of a positive prediction and the minimum probability of a positive prediction across all racial groups is calculated.</p>
<p><span class="math display">\[SPD = \max_{r \in R} P(\hat{Y} = 1 | R = r) - \min_{r \in R} P(\hat{Y} = 1 | R = r)\]</span></p>
<p>Where <span class="math inline">\(R\)</span> is the set of all racial groups in the data and <span class="math inline">\(\hat{Y}\)</span> is the model’s predicted employment status. The SPD metric is a measure of the difference in the model’s predictions across racial groups. Only a value of <span class="math inline">\(0\)</span> indicates that the model’s predictions are consistent across all racial groups. The model’s statistical parity difference for each racial group is roughly <span class="math inline">\(38\%\)</span>. This metric lies well above the accepted ABS. SPD (<span class="math inline">\(0\)</span>) value associated with true fairness <a href="https://www.mathworks.com/help/risk/explore-fairness-metrics-for-credit-scoring-model.html">found here</a>, indicating that the model likely exhibits biases in its predictions across racial groups and therefore does not satisfy statistical parity.</p>
</section>
<section id="reproducing-figure-5-from-chouldechova" class="level4">
<h4 class="anchored" data-anchor-id="reproducing-figure-5-from-chouldechova">Reproducing <strong>Figure 5</strong> from Chouldechova</h4>
<div id="cell-44" class="cell" data-execution_count="179">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining FPR as linear function of FNR when PPV and P are held constant for white and black or African American individuals in the data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Calculating P for white and black or African American individuals in the data</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>p_w <span class="op">=</span> train[train[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">1.0</span>][<span class="st">"emp_status"</span>].<span class="bu">sum</span>() <span class="op">/</span> train[train[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">1.0</span>].shape[<span class="dv">0</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>p_b <span class="op">=</span> train[train[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">2.0</span>][<span class="st">"emp_status"</span>].<span class="bu">sum</span>() <span class="op">/</span> train[train[<span class="st">"race"</span>] <span class="op">==</span> <span class="fl">2.0</span>].shape[<span class="dv">0</span>]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pulling PPV for white and black or African American individuals from Table 1</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>ppv_min <span class="op">=</span> <span class="bu">min</span>((race_acc[<span class="st">"PPV"</span>].iloc[<span class="dv">0</span>] <span class="op">/</span> <span class="dv">100</span>), (race_acc[<span class="st">"PPV"</span>].iloc[<span class="dv">2</span>] <span class="op">/</span> <span class="dv">100</span>))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the relevant information in a data frame</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>fpr_by_fnr <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> [<span class="st">"FNRW"</span>, <span class="st">"FPRW"</span>, <span class="st">"FNRB"</span>, <span class="st">"FPRB"</span>])</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>fpr_by_fnr[<span class="st">"FNRB"</span>] <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>fpr_by_fnr[<span class="st">"FNRW"</span>] <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>fpr_by_fnr[<span class="st">"FPRB"</span>] <span class="op">=</span> (p_b <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> p_b)) <span class="op">*</span> ((<span class="dv">1</span> <span class="op">-</span> ppv_min) <span class="op">/</span> ppv_min) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> fpr_by_fnr[<span class="st">"FNRB"</span>])</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>fpr_by_fnr[<span class="st">"FPRW"</span>] <span class="op">=</span> (p_w <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> p_w)) <span class="op">*</span> ((<span class="dv">1</span> <span class="op">-</span> ppv_min) <span class="op">/</span> ppv_min) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> fpr_by_fnr[<span class="st">"FNRW"</span>])</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plotting the FPR as a linear function of FNR</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="fl">12.5</span>, <span class="fl">7.5</span>))</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">"seaborn-v0_8-whitegrid"</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>sns.lineplot(fpr_by_fnr, x <span class="op">=</span> fpr_by_fnr[<span class="st">"FNRW"</span>], y <span class="op">=</span> fpr_by_fnr[<span class="st">"FPRW"</span>], ax <span class="op">=</span> ax, color <span class="op">=</span> <span class="st">"darkorange"</span>, label <span class="op">=</span> <span class="st">"White Individuals"</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>sns.lineplot(fpr_by_fnr, x <span class="op">=</span> fpr_by_fnr[<span class="st">"FNRB"</span>], y <span class="op">=</span> fpr_by_fnr[<span class="st">"FPRB"</span>], ax <span class="op">=</span> ax, color <span class="op">=</span> <span class="st">"darkgrey"</span>, label <span class="op">=</span> <span class="st">"Black or African American Individuals"</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>ax.scatter(race_acc[<span class="st">"FNR"</span>].iloc[<span class="dv">2</span>] <span class="op">/</span> <span class="dv">100</span>, race_acc[<span class="st">"FPR"</span>].iloc[<span class="dv">2</span>] <span class="op">/</span> <span class="dv">100</span>, color <span class="op">=</span> <span class="st">"darkgray"</span>, s <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>ax.scatter(race_acc[<span class="st">"FNR"</span>].iloc[<span class="dv">0</span>] <span class="op">/</span> <span class="dv">100</span>, race_acc[<span class="st">"FPR"</span>].iloc[<span class="dv">0</span>] <span class="op">/</span> <span class="dv">100</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, s <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Feasible (FNR, FPR) Combinations"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"False Negative Rate"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"False Positive Rate"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>ax.set_xticks([(<span class="fl">.25</span> <span class="op">*</span> i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)])</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(race_acc[<span class="st">"FNR"</span>].iloc[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>17.9</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-17-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Code above plots FPR as a function of FNR, PPV, and prevalence for individuals identifying as white and those identifying as black or African American.</em></p>
<p><strong>Figure 8</strong></p>
<p>The plot above is a reproduction of <strong>Figure 5</strong> from Chouldechova’s 2017 publication “Fair prediction with disparate impact: A study of bias in recidivism prediction instruments”. For white and black or African American individuals in the data, the plot displays the model’s FPR as a linear function of FNR when the prevalence <span class="math inline">\(p\)</span> and PPV are held constant. Specifically, the function(s) plotted above are:</p>
<p><span class="math display">\[FPR = \frac{p}{1 - p} * \frac{1 - PPV}{PPV} * (1 - FNR)\]</span></p>
<p>Based on this figure, to tune the refined model to yield equal FPR values for white and black or African American individuals, the model’s FNR for white individuals would need to be increased by around 10 percentage points (increasing from what appears to be about <span class="math inline">\(1\%\)</span> to about <span class="math inline">\(27\%\)</span>). This indicates that equalizing FPR values for white and black or African American individuals would require a decrease in the model’s accuracy for white individuals.</p>
</section>
</section>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p><strong>1. Groups this model provide benefits to</strong></p>
<p>There are various different populations in society and the general workforce that could stand to benefit from a predictive system like the one explored in this study. Consider companies and private organizations seeking to grow capital that are concerned with distributing certain services to individuals who are employed and others to those who aren’t. Some examples of these types of companies include insurance companies (aiming to sell insurance plans to customers), real estate renters (aiming to rent properties to individuals who have reasonable means of paying rent), and banks (aiming to receive profit back from loans repaid by borrowers). For each of these organizations, it is highly useful to have an accurate prediction of a prospective customer’s employment status as it will have a large impact (often whether or not to sell something at all) on these companies’ business strategies.</p>
<p><strong>2. Impact of deploying this model</strong></p>
<p>The results of my audit show that this model does not operate in strict alignment with several of the primary criteria of statistical “fairness” on the basis of the racial identity of individuals. Specifically, I found that while this model is moderately calibrated to the enumerated racial groups, it ultimately failed to produce balanced error rates and achieve statistical parity across all racial identities found in the data. With this, this model’s impact on society following mass deployment and usage could likely involve the propagation of systemic biases and reflection of historical injustices falling on people of certain racial identities. That is, the mass use of this “unfair” model is likely to produce discriminatory circumstances in most, if not all, of the applications in which it is used. Whether in commercial, governmental, or public settings, the risk of harm associated with this model may find ways to radiate out into the world.</p>
<p><strong>3. Biases in this model</strong></p>
<p>As touched on above, I feel that the bias audit conducted on this model reveals its exhibition of problematic bias in several ways. As discussed, the bias audit of this model focused on the model’s “fairness” across race. From investigating the disparities found in error rates (FPR and FNR – misclassifications of individuals) and the inconsistencies found in the probabilities of “positive” (i.e.&nbsp;“employed”) predictions, I feel that it is reasonable to assert that the model exercises biases through unequal error rates and its lack of statistical parity. It is important to note, however, that this study only investigates some of the generally accepted metrics of statistical “fairness”. Additionally, the specific audit processes followed could possibly be re-conducted differently to account for other potentially relevant information such as the proportion of each racial group present in the data. All this to say, a further and or more thorough examination of bias in this model may show that some of the findings from this analysis hold different levels of significance.</p>
<p><strong>4. Additional concerns</strong></p>
<p>One of my primary concerns with deploying this model traces back to the training data used to construct and refine the model’s behavior. This model is only trained on data from a single US state. There is no question that certain characteristics from the training data used will be considerably different from analogous data sets from other states or even other countries. For example, the racial makeup of Massachusetts is definitively different from that of New York: If the model was trained using ACS PUMS data from New York, it may very well exhibit different behaviors relating to employment status prediction and race. Additionally, I fear that some of the variable definitions present in the data could be harmful to certain populations of people. For example, the <code>SEX</code> variable is a binary, indicating that all individuals from the data fall into one of two identities for this variable. But, in greater society, many folks do not identify according to this binary encoding. That is, I am concerned with the generalization implied by the design of some of the variables used in this data and how it could have a constructive effect on specific people – This negative effect may manifest further through intersectional biases exhibited by the model. To address these concerns, I would propose that this model be trained on and designed to process many different data sets; including multiple from the data source initially used in addition to data collected from entirely different sources. I recognize that this data set diversification will likely add considerable complexity to the model designing and refining processes. However, I feel that the trade-off in construction simplicity for a more holistic, fair-leaning model is well worth it.</p>
<p><em>During the implementation process of this replication study, I collaborated with Omar Armbruster.</em></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>